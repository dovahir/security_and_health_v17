<?xml version="1.0" encoding="UTF-8"?>

<odoo>

    <record id="action_report_final_situation" model="ir.actions.report">
        <field name="name">Informe Final de Situación</field>
        <field name="model">final.report</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">security_and_health.report_final_document</field>
        <field name="report_file">security_and_health.report_final_document</field>
        <field name="print_report_name">'Informe -%s' % (object.security_situation_id.name)</field>
        <field name="binding_model_id" ref="model_final_report"/>
        <field name="binding_type">report</field>
    </record>

    <record id="view_final_report_form" model="ir.ui.view">
        <field name="name">Final Report Form</field>
        <field name="model">final.report</field>
        <field name="arch" type="xml">
            <form string="Reporte Final" create="false">
                <header>
                    <button name="%(security_and_health.action_report_final_situation)d"
                            string="Imprimir Informe" type="action" class="btn-primary" icon="fa-print"/>
                </header>

                <sheet>

                    <group>
                        <field name="security_situation_id" readonly="1"/>
                    </group>
                    <group>
                        <group>
                            <field name="actual_laboral_state"/>
                            <field name="given_days" invisible="actual_laboral_state == 'normal'"/>
                            <field name="attention_type"/>
                            <field name="attention_cost" invisible="attention_type != 'private'"/>
                        </group>
                    </group>
                    <div class="alert alert-warning" role="alert" invisible="given_days == '0'">
                        <field name="return_date_warning" nolable="1" readonly="1"/>
                    </div>
                    <notebook>
                        <page string="Investigación de Causas">
                            <field name="corrective_actions" placeholder="Causas inmediatas, Causa Raíz, Acciones..."/>
                        </page>

                        <page string="Lecciones Aprendidas">
                                <field name="lessons_learned" placeholder="Que ocurrió, Donde, Cuando, Causa Raíz, Acciones..."/>
                        </page>

                        <page string="Comentarios Finales">
                            <field name="final_summary" placeholder="Comentarios finales..."/>
                        </page>
                    </notebook>

                </sheet>

                 <div class="oe_chatter">
                   <field name="message_follower_ids" groups="base.group_user"/>
                   <field name="message_ids" widget="mail_thread"/>
                 </div>

            </form>
        </field>
    </record>

    <record id="view_final_report_tree" model="ir.ui.view">
        <field name="name">Final Report Tree</field>
        <field name="model">final.report</field>
        <field name="arch" type="xml">
            <tree string="Reportes Finales" create="false">
                <field name="security_situation_id" decoration-bf="1"/>
                <field name="final_report_employee_id" widget="many2one_avatar_user"/>
            </tree>
        </field>
    </record>

    <record id="view_final_report_search" model="ir.ui.view">
        <field name="name">Security Attention Search</field>
        <field name="model">final.report</field>
        <field name="arch" type="xml">
            <search>

                <group expand="1" string="Agrupar por">
                    <filter name="group_by_employee" string="Empleado"
                            context="{'group_by': 'final_report_employee_id'}"/>
                </group>
            </search>
        </field>
    </record>

    <record id="action_final_report" model="ir.actions.act_window">
        <field name="name">Reportes Finales</field>
        <field name="res_model">final.report</field>
        <field name="view_mode">tree,form</field>
    </record>

</odoo>